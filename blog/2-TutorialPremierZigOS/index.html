<!DOCTYPE html>
<html lang="en">
  <head id="head">
    <meta charset="utf-8">
    <title id="title">
      Tutoriel : Créer votre premier Kernel Zig
      | Mathieu Roy's Blog
    </title>
    <meta name="description" content="Mathieu Roy's Blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@croloris">
    <meta name="twitter:image" content="https://mathroy0310.github.io/logo.jpeg">
    <meta name="twitter:author" content="@croloris">
    <meta name="twitter:description" content="Mathieu Roy's Blog">
    <meta name="twitter:title" content="Tutoriel : Créer votre premier Kernel Zig">
    <meta property="og:title" content="Tutoriel : Créer votre premier Kernel Zig">
    <meta property="og:type" content="website">
    <meta
    property="og:image"
    content="http:mathroy0310.github.io/logo.jpeg"
  >
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/main.css">
    <link
    type="text/css"
    rel="stylesheet"
    href="/highlight.css"
  >
    
    <link type="text/css" rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link type="text/css" rel="stylesheet" href="/term-highlight.css">
    <style>
      .title {
        font-size: 2.5rem;
      }

      .back {
        text-decoration: none;
        padding: 0.5rem 1rem;
      }

      .tag {
        color: var(--accent);
        border-radius: 4px;
        padding: 2px;
        font-size: 0.8em;
      }

      table {
        width: 100%;
      }
    </style>
  
  </head>
  <body>
    <div id="content">
      
    <a class="back" href="/"><i class="fa-solid fa-chevron-left"></i> back</a>
    <div style="display:flex; flex-direction:column; align-items:center;">
      <h1 id="header"><a class="reset-a" href="/">Mathieu Roy</a></h1>
      <small><i>Mon Site Web</i></small>
      <div style="display:flex; justify-content:center; font-size:small;">
        <a href="https://x.com/freemathieuroy">Twitter</a>
        &nbsp; • &nbsp;
        <a href="https://www.linkedin.com/in/mathieu-roy-301989224/">LinkedIn</a>
        &nbsp; • &nbsp;
        <a href="https://github.com/mathroy0310">GitHub</a>
        &nbsp; • &nbsp;
        <a href="/CVMathieuRoy.pdf">CV</a>
      </div>
    </div>
    <h1 >Tutoriel : Créer votre premier Kernel Zig</h1>
    <p class="post-byline">
      <span >September 03, 2024</span>
      •
      <span >9</span>
      min • by
      <b >Mathieu Roy</b>
      <span ></span>
    </p>
    <div id="post-description" ></div>
    <div id="post-body" ><h2>Introduction</h2><p>Bienvenue dans ce tutoriel approfondi sur la création d'un kernel minimaliste en utilisant le langage de programmation Zig. Ce guide est conçu pour les développeurs qui souhaitent plonger dans les profondeurs du développement système et comprendre les mécanismes fondamentaux qui sous-tendent les systèmes d'exploitation modernes. Zig, un langage relativement nouveau dans l'écosystème des langages de programmation système, offre une approche rafraîchissante du développement bas niveau. Avec sa syntaxe claire, ses garanties de sécurité et sa capacité à interagir directement avec le matériel, Zig est un excellent choix pour l'écriture de kernels et de systèmes d'exploitation.</p><h3>Pourquoi créer un kernel en Zig ?</h3><ol><li><strong>Apprentissage approfondi</strong> : La création d'un kernel vous permet de comprendre intimement le fonctionnement d'un ordinateur au niveau le plus bas.</li><li><strong>Maîtrise de Zig</strong> : Ce projet vous fera explorer des aspects avancés de Zig, comme la programmation sans allocation dynamique et l'interaction directe avec le matériel.</li><li><strong>Exploration du développement système</strong> : Vous découvrirez les défis uniques liés au développement de logiciels sans le support d'un système d'exploitation sous-jacent.</li></ol><h2>Prérequis</h2><p>Avant de commencer, assurez-vous d'avoir :</p><ol><li><p><strong>Zig 0.13 ou supérieur</strong> :</p><ul><li>Téléchargeable sur <a href="https://ziglang.org/download/">https://ziglang.org/download/</a></li><li>Vérifiez l'installation avec <code>zig version</code> dans votre terminal</li></ul></li><li><p><strong>QEMU</strong> :</p><ul><li>Un émulateur puissant qui nous permettra de tester notre kernel sans matériel dédié</li><li>Téléchargeable sur <a href="https://www.qemu.org/download/">https://www.qemu.org/download/</a></li><li>Assurez-vous que <code>qemu-system-i386</code> est dans votre PATH</li></ul></li><li><p><strong>Connaissances de base</strong> :</p><ul><li>Familiarité avec la programmation en général</li><li>Compréhension basique de l'architecture x86</li><li>Notions de base sur les systèmes d'exploitation</li></ul></li></ol><h2>Structure du projet</h2><p>Voici comment nous allons organiser notre projet :</p><pre><code>MyFirstZigOS/
├── kernel/
│   ├── boot.zig       # Code de démarrage et en-tête multiboot
│   ├── kernel.zig     # Fonctions principales du kernel
│   └── linker.ld      # Script de liaison pour organiser la mémoire
└── build.zig          # Script de construction Zig
</code></pre><p>Cette structure sépare clairement les différentes composantes de notre kernel :</p><ul><li><code>boot.zig</code> contient le code exécuté au tout début du démarrage.</li><li><code>kernel.zig</code> contient la logique principale de notre kernel.</li><li><code>linker.ld</code> définit comment notre kernel sera organisé en mémoire.</li><li><code>build.zig</code> configure le processus de compilation.</li></ul><h2>Étape 1 : Le bootloader (boot.zig)</h2><pre><code class="zig"><span class="comment">// kernel/boot.zig</span>
<span class="type qualifier">const</span> <span class="variable">std</span> = <span class="function builtin">@import</span><span class="punctuation bracket">(</span><span class="string">"std"</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

<span class="comment">// Constants pour l'en-tête multiboot</span>
<span class="attribute">pub</span> <span class="type qualifier">const</span> <span class="variable">ALIGN</span> = <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">0</span><span class="punctuation delimiter">;</span>
<span class="attribute">pub</span> <span class="type qualifier">const</span> <span class="variable">MEMINFO</span> = <span class="number">1</span> <span class="operator">&lt;&lt;</span> <span class="number">1</span><span class="punctuation delimiter">;</span>
<span class="attribute">pub</span> <span class="type qualifier">const</span> <span class="variable">FLAGS</span> = <span class="variable">ALIGN</span> <span class="operator">|</span> <span class="variable">MEMINFO</span><span class="punctuation delimiter">;</span>
<span class="attribute">pub</span> <span class="type qualifier">const</span> <span class="variable">MAGIC</span> = <span class="number">0x1BADB002</span><span class="punctuation delimiter">;</span>
<span class="attribute">pub</span> <span class="type qualifier">const</span> <span class="variable">CHECKSUM</span> = <span class="operator">-</span><span class="punctuation bracket">(</span><span class="variable">MAGIC</span> <span class="operator">+</span> <span class="variable">FLAGS</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

<span class="comment">// En-tête multiboot</span>
<span class="attribute">export</span> <span class="type qualifier">var</span> <span class="variable">multiboot_header</span> <span class="storageclass">align</span><span class="punctuation bracket">(</span><span class="number">4</span><span class="punctuation bracket">)</span> <span class="storageclass">linksection</span><span class="punctuation bracket">(</span><span class="string">".multiboot"</span><span class="punctuation bracket">)</span> = <span class="punctuation bracket">[</span><span class="variable builtin">_</span><span class="punctuation bracket">]</span><span class="type builtin">i32</span><span class="punctuation bracket">{</span> <span class="variable">MAGIC</span><span class="punctuation delimiter">,</span> <span class="variable">FLAGS</span><span class="punctuation delimiter">,</span> <span class="variable">CHECKSUM</span> <span class="punctuation bracket">}</span><span class="punctuation delimiter">;</span>

<span class="comment">// Point d'entrée</span>
<span class="attribute">export</span> <span class="keyword function">fn</span> <span class="function">_start</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span> <span class="storageclass">callconv</span><span class="punctuation bracket">(</span><span class="punctuation delimiter">.</span><span class="variable builtin">Naked</span><span class="punctuation bracket">)</span> <span class="type builtin">noreturn</span> <span class="punctuation bracket">{</span>
    <span class="function builtin">@setRuntimeSafety</span><span class="punctuation bracket">(</span><span class="boolean">false</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="keyword">asm</span> <span class="type qualifier">volatile</span> <span class="punctuation bracket">(</span>
        <span class="string">\\call kernel_main</span>
        <span class="string">\\hlt</span>
    <span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="constant builtin">unreachable</span><span class="punctuation delimiter">;</span>
<span class="punctuation bracket">}</span>
</code></pre>
<h4>Explications :</h4><ol><li><p><strong>En-tête Multiboot</strong> :</p><ul><li>Multiboot est un standard pour les bootloaders, permettant une interface commune entre le bootloader et le kernel.</li><li><code>ALIGN</code> et <code>MEMINFO</code> sont des drapeaux indiquant nos besoins au bootloader.</li><li><code>MAGIC</code> est une valeur spécifique que le bootloader recherche pour identifier un kernel compatible.</li><li><code>CHECKSUM</code> est calculé pour vérifier l'intégrité de l'en-tête.</li></ul></li><li><p><strong>Exportation de l'en-tête</strong> :</p><ul><li><code>export var multiboot_header</code> rend l'en-tête visible pour le linker.</li><li><code>align(4)</code> assure que l'en-tête est aligné sur une adresse divisible par 4, une exigence de nombreux processeurs x86.</li><li><code>linksection(".multiboot")</code> place cet en-tête dans une section spécifique de notre binaire final.</li></ul></li><li><p><strong>Fonction <code>_start</code></strong> :</p><ul><li>C'est le véritable point d'entrée de notre kernel.</li><li><code>callconv(.Naked)</code> indique qu'aucun prologue ou épilogue de fonction ne doit être généré.</li><li><code>noreturn</code> signifie que cette fonction ne retournera jamais.</li><li><code>@setRuntimeSafety(false)</code> désactive les vérifications de sécurité à l'exécution, nécessaire car nous opérons dans un environnement sans support runtime.</li><li>L'assembleur inline appelle <code>kernel_main</code> puis entre dans une boucle d'arrêt (<code>hlt</code>).</li></ul></li></ol><h2>Étape 2 : Le kernel (kernel.zig)</h2><p>Maintenant, écrivons notre kernel minimaliste :</p><pre><code class="zig"><span class="comment">// kernel/kernel.zig</span>
<span class="type qualifier">const</span> <span class="variable">std</span> = <span class="function builtin">@import</span><span class="punctuation bracket">(</span><span class="string">"std"</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

<span class="comment">// Pointeur vers le buffer de la mémoire vidéo</span>
<span class="type qualifier">var</span> <span class="variable">terminal_buffer</span><span class="punctuation delimiter">:</span> <span class="punctuation bracket">[</span><span class="operator">*</span><span class="punctuation bracket">]</span><span class="type qualifier">volatile</span> <span class="type builtin">u16</span> = <span class="function builtin">@ptrFromInt</span><span class="punctuation bracket">(</span><span class="number">0xB8000</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

<span class="comment">// Fonction principale du kernel</span>
<span class="attribute">export</span> <span class="keyword function">fn</span> <span class="function">kernel_main</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span> <span class="type builtin">void</span> <span class="punctuation bracket">{</span>
    <span class="comment">// Effacer l'écran</span>
    <span class="repeat">for</span> <span class="punctuation bracket">(</span><span class="number">0</span><span class="punctuation special">..</span><span class="number">25</span><span class="punctuation bracket">)</span> |<span class="variable">y</span>| <span class="punctuation bracket">{</span>
        <span class="repeat">for</span> <span class="punctuation bracket">(</span><span class="number">0</span><span class="punctuation special">..</span><span class="number">80</span><span class="punctuation bracket">)</span> |<span class="variable">x</span>| <span class="punctuation bracket">{</span>
            <span class="type qualifier">const</span> <span class="variable">index</span> = <span class="variable">y</span> <span class="operator">*</span> <span class="number">80</span> <span class="operator">+</span> <span class="variable">x</span><span class="punctuation delimiter">;</span>
            <span class="variable">terminal_buffer</span><span class="punctuation bracket">[</span><span class="variable">index</span><span class="punctuation bracket">]</span> <span class="operator">=</span> <span class="function builtin">@as</span><span class="punctuation bracket">(</span><span class="type builtin">u16</span><span class="punctuation delimiter">,</span> <span class="character">' '</span><span class="punctuation bracket">)</span> <span class="operator">|</span> <span class="punctuation bracket">(</span><span class="function builtin">@as</span><span class="punctuation bracket">(</span><span class="type builtin">u16</span><span class="punctuation delimiter">,</span> <span class="number">0x00</span><span class="punctuation bracket">)</span> <span class="operator">&lt;&lt;</span> <span class="number">8</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
        <span class="punctuation bracket">}</span>
    <span class="punctuation bracket">}</span>

    <span class="comment">// Afficher un message</span>
    <span class="type qualifier">const</span> <span class="variable">msg</span> = <span class="string">"Hello, World from Zig Kernel!"</span><span class="punctuation delimiter">;</span>
    <span class="type qualifier">var</span> <span class="variable">index</span><span class="punctuation delimiter">:</span> <span class="type builtin">usize</span> = <span class="number">0</span><span class="punctuation delimiter">;</span>

    <span class="repeat">for</span> <span class="punctuation bracket">(</span><span class="variable">msg</span><span class="punctuation bracket">)</span> |<span class="variable">c</span>| <span class="punctuation bracket">{</span>
        <span class="variable">terminal_buffer</span><span class="punctuation bracket">[</span><span class="variable">index</span><span class="punctuation bracket">]</span> <span class="operator">=</span> <span class="function builtin">@as</span><span class="punctuation bracket">(</span><span class="type builtin">u16</span><span class="punctuation delimiter">,</span> <span class="variable">c</span><span class="punctuation bracket">)</span> <span class="operator">|</span> <span class="punctuation bracket">(</span><span class="function builtin">@as</span><span class="punctuation bracket">(</span><span class="type builtin">u16</span><span class="punctuation delimiter">,</span> <span class="number">0x0F</span><span class="punctuation bracket">)</span> <span class="operator">&lt;&lt;</span> <span class="number">8</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
        <span class="variable">index</span> <span class="operator">+=</span> <span class="number">1</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>
<span class="punctuation bracket">}</span>
</code></pre>
<h4>Explications :</h4><ol><li><p><strong>Mémoire vidéo</strong> :</p><ul><li><code>0xB8000</code> est l'adresse standard du buffer vidéo en mode texte VGA.</li><li>Chaque caractère occupe 2 octets : un pour le caractère ASCII, un pour les attributs (couleur, etc.).</li><li><code>volatile</code> indique au compilateur que cette mémoire peut changer indépendamment du flux du programme.</li></ul></li><li><p><strong>Effacement de l'écran</strong> :</p><ul><li>Nous parcourons les 25 lignes et 80 colonnes standard du mode texte VGA.</li><li>Chaque cellule est remplie avec un espace (<code> </code>) et des attributs nuls (noir sur noir).</li></ul></li><li><p><strong>Affichage du message</strong> :</p><ul><li>Chaque caractère est combiné avec l'attribut <code>0x0F</code> (blanc brillant sur noir) via un OU bitwise.</li><li>Le résultat est écrit directement dans le buffer vidéo, ce qui l'affiche instantanément à l'écran.</li></ul></li></ol><h2>Étape 3 : Le script de liaison (linker.ld)</h2><p>Le script de liaison est crucial pour placer correctement notre code en mémoire :</p><pre><code>/* kernel/linker.ld */
ENTRY(_start)

SECTIONS {
    . = 1M;

    .text BLOCK(4K) : ALIGN(4K) {
        *(.multiboot)
        *(.text)
    }

    .rodata BLOCK(4K) : ALIGN(4K) {
        *(.rodata)
    }

    .data BLOCK(4K) : ALIGN(4K) {
        *(.data)
    }

    .bss BLOCK(4K) : ALIGN(4K) {
        *(COMMON)
        *(.bss)
    }
}
</code></pre><h4>Explications :</h4><ol><li><p><strong>Point d'entrée</strong> :</p><ul><li><code>ENTRY(_start)</code> définit <code>_start</code> comme le point d'entrée du programme.</li></ul></li><li><p><strong>Adresse de chargement</strong> :</p><ul><li><code>. = 1M</code> place le début de notre kernel à l'adresse 1 Mo, une convention courante pour les kernels x86.</li></ul></li><li><p><strong>Sections</strong> :</p><ul><li><code>.text</code> : contient le code exécutable, y compris notre en-tête multiboot.</li><li><code>.rodata</code> : données en lecture seule (constantes, chaînes statiques).</li><li><code>.data</code> : variables globales initialisées.</li><li><code>.bss</code> : variables globales non initialisées.</li></ul></li><li><p><strong>Alignement</strong> :</p><ul><li><code>BLOCK(4K)</code> et <code>ALIGN(4K)</code> assurent que chaque section commence sur une frontière de page (4 Ko), important pour la gestion de la mémoire du kernel.</li></ul></li></ol><h2>Étape 4 : Configuration de la compilation (build.zig)</h2><p>Enfin, configurons notre build system avec Zig :</p><pre><code class="zig"><span class="comment">// build.zig</span>
<span class="type qualifier">const</span> <span class="variable">std</span> = <span class="function builtin">@import</span><span class="punctuation bracket">(</span><span class="string">"std"</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

<span class="attribute">pub</span> <span class="keyword function">fn</span> <span class="function">build</span><span class="punctuation bracket">(</span><span class="parameter">b</span><span class="punctuation delimiter">:</span> <span class="operator">*</span><span class="variable">std</span><span class="punctuation delimiter">.</span><span class="field">Build</span><span class="punctuation bracket">)</span> <span class="type builtin">void</span> <span class="punctuation bracket">{</span>
    <span class="type qualifier">const</span> <span class="variable">target</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">standardTargetOptions</span><span class="punctuation bracket">(</span><span class="punctuation delimiter">.</span><span class="punctuation bracket">{</span> <span class="punctuation delimiter">.</span><span class="field">default_target</span> = <span class="punctuation delimiter">.</span><span class="punctuation bracket">{</span>
        <span class="punctuation delimiter">.</span><span class="field">cpu_arch</span> = <span class="punctuation delimiter">.</span><span class="variable builtin">x86</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">os_tag</span> = <span class="punctuation delimiter">.</span><span class="variable builtin">freestanding</span><span class="punctuation delimiter">,</span>
    <span class="punctuation bracket">}</span> <span class="punctuation bracket">}</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="type qualifier">const</span> <span class="variable">optimize</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">standardOptimizeOption</span><span class="punctuation bracket">(</span><span class="punctuation delimiter">.</span><span class="punctuation bracket">{</span><span class="punctuation bracket">}</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="type qualifier">const</span> <span class="variable">boot</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">addExecutable</span><span class="punctuation bracket">(</span><span class="punctuation delimiter">.</span><span class="punctuation bracket">{</span>
        <span class="punctuation delimiter">.</span><span class="field">name</span> = <span class="string">"MyFirstZigOS"</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">root_source_file</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">path</span><span class="punctuation bracket">(</span><span class="string">"kernel/boot.zig"</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">target</span> = <span class="variable">target</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">optimize</span> = <span class="variable">optimize</span><span class="punctuation delimiter">,</span>
    <span class="punctuation bracket">}</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="type qualifier">const</span> <span class="variable">kernel</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">addObject</span><span class="punctuation bracket">(</span><span class="punctuation delimiter">.</span><span class="punctuation bracket">{</span>
        <span class="punctuation delimiter">.</span><span class="field">name</span> = <span class="string">"MyFirstZigKernel"</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">root_source_file</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">path</span><span class="punctuation bracket">(</span><span class="string">"kernel/kernel.zig"</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">target</span> = <span class="variable">target</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">optimize</span> = <span class="variable">optimize</span><span class="punctuation delimiter">,</span>
        <span class="punctuation delimiter">.</span><span class="field">code_model</span> = <span class="punctuation delimiter">.</span><span class="variable builtin">kernel</span><span class="punctuation delimiter">,</span>
    <span class="punctuation bracket">}</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="variable">boot</span><span class="punctuation delimiter">.</span><span class="function">setLinkerScriptPath</span><span class="punctuation bracket">(</span><span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">path</span><span class="punctuation bracket">(</span><span class="string">"kernel/linker.ld"</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="variable">boot</span><span class="punctuation delimiter">.</span><span class="function">addObject</span><span class="punctuation bracket">(</span><span class="variable">kernel</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">installArtifact</span><span class="punctuation bracket">(</span><span class="variable">boot</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="type qualifier">const</span> <span class="variable">run_cmd</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">addSystemCommand</span><span class="punctuation bracket">(</span><span class="operator">&</span><span class="punctuation bracket">[</span><span class="variable builtin">_</span><span class="punctuation bracket">]</span><span class="punctuation bracket">[</span><span class="punctuation bracket">]</span><span class="type qualifier">const</span> <span class="type builtin">u8</span><span class="punctuation bracket">{</span>
        <span class="string">"qemu-system-i386"</span><span class="punctuation delimiter">,</span>
        <span class="string">"-kernel"</span><span class="punctuation delimiter">,</span>
        <span class="string">"./zig-out/bin/MyFirstZigOS"</span><span class="punctuation delimiter">,</span>
    <span class="punctuation bracket">}</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="variable">run_cmd</span><span class="punctuation delimiter">.</span><span class="field">step</span><span class="punctuation delimiter">.</span><span class="function">dependOn</span><span class="punctuation bracket">(</span><span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">getInstallStep</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="type qualifier">const</span> <span class="variable">run_step</span> = <span class="variable">b</span><span class="punctuation delimiter">.</span><span class="function">step</span><span class="punctuation bracket">(</span><span class="string">"run"</span><span class="punctuation delimiter">,</span> <span class="string">"Run the kernel in QEMU"</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="variable">run_step</span><span class="punctuation delimiter">.</span><span class="function">dependOn</span><span class="punctuation bracket">(</span><span class="operator">&</span><span class="variable">run_cmd</span><span class="punctuation delimiter">.</span><span class="field">step</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
<span class="punctuation bracket">}</span>
</code></pre>
<h4>Explications :</h4><ol><li><p><strong>Configuration de la cible</strong> :</p><ul><li><code>.cpu_arch = .x86</code> : nous ciblons l'architecture x86.</li><li><code>.os_tag = .freestanding</code> : indique que nous compilons sans OS sous-jacent.</li></ul></li><li><p><strong>Création des artefacts</strong> :</p><ul><li><code>boot</code> est l'exécutable final, basé sur <code>boot.zig</code>.</li><li><code>kernel</code> est un objet séparé, basé sur <code>kernel.zig</code>.</li><li>L'utilisation de <code>.code_model = .kernel</code> pour <code>kernel</code> optimise le code pour un environnement kernel.</li></ul></li><li><p><strong>Liaison</strong> :</p><ul><li><code>boot.setLinkerScriptPath(...)</code> utilise notre script de liaison personnalisé.</li><li><code>boot.addObject(kernel)</code> inclut l'objet <code>kernel</code> dans l'exécutable final.</li></ul></li><li><p><strong>Commande d'exécution</strong> :</p><ul><li>Configure QEMU pour exécuter notre kernel nouvellement compilé.</li></ul></li></ol><h2>Compilation et exécution</h2><p>Pour compiler et exécuter votre kernel :</p><ol><li>Ouvrez un terminal dans le répertoire du projet.</li><li>Exécutez <code>zig build</code> pour compiler le kernel.<ul><li>Cette commande compile le code source et lie les objets selon les spécifications de <code>build.zig</code>.</li></ul></li><li>Exécutez <code>zig build run</code> pour lancer le kernel dans QEMU.<ul><li>Cette commande lance QEMU avec les paramètres appropriés pour charger et exécuter votre kernel.</li></ul></li></ol><p>Si tout se passe bien, vous devriez voir une fenêtre QEMU s'ouvrir avec le message <strong>"Hello, World from Zig Kernel!"</strong> affiché en haut à gauche de l'écran.</p><h2>Conclusion et perspectives</h2><p>Félicitations ! Vous venez de créer et d'exécuter votre premier kernel en Zig. Bien que simple, ce kernel démontre plusieurs concepts fondamentaux :</p><ol><li><strong>Démarrage bas niveau</strong> : L'utilisation de l'en-tête Multiboot et la fonction <code>_start</code>.</li><li><strong>Interaction directe avec le matériel</strong> : L'écriture dans le buffer vidéo.</li><li><strong>Compilation et liaison personnalisées</strong> : L'utilisation d'un script de liaison et d'un build system Zig.</li></ol><p>Ce n'est que le début de ce que vous pouvez accomplir. Voici quelques pistes pour approfondir vos connaissances :</p><ul><li><strong>kprint</strong> : Implémentez un meilleur systeme pour ecrire dans le buffer video.</li><li><strong>Interruptions</strong> : Configurez la table d'interruption (IDT) pour gérer les interruptions matérielles et logicielles.</li><li><strong>Global Descriptor Table</strong> : Implémentez la structure de données (GDT) utilisée pour référencer les descripteurs de segment les plus utilisés par les processus.</li></ul><p>Le développement de kernel est un domaine vaste et passionnant. Chaque nouvelle fonctionnalité que vous ajouterez vous fera plonger plus profondément dans les mécanismes internes des systèmes d'exploitation et de l'architecture des ordinateurs.</p><p>Bon codage, et que votre voyage dans le développement de kernel soit enrichissant et passionnant !</p><p>Voir le code source <a href="https://github.com/mathroy0310/MyFirstZigOS/tree/master">MyFirstZigOS</a></p></div>
    <hr>
    <div id="prev-next">
      <i>★ Continuer la Lecture ★</i>
      <span >
        <a href="/blog/1-LaGestionDeLaMemoireKernels/">
          <i class="fa-solid fa-arrow-left"></i>  
          <span >La gestion de la mémoire dans le développement de kernels</span>
        </a>
      </span>

      <span ></span>

      <span ></span>
      <small >&nbsp; or &nbsp;</small>
      <small>
        <a href="/">Retour à la Page d'Accueil</a>
      </small>
    </div>
  
    </div>
  </body>
</html>